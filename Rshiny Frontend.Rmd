---
title: "Rshiny Frontend"
author: "Baiq Nina Febriati"
date: "2025-02-26"
output: 
---

```{r}
# === 1. Load Library ===
library(shiny)
library(shinydashboard)
library(DT)
library(ggplot2)
library(readr)
library(dplyr)
library(leaflet)  

# === 2. Membaca Data CSV ===
data_penulis <- read_csv("C:/Users/ASUS/OneDrive/Dokumen/Data Novel/penulis.csv")
data_penerbit <- read_csv("C:/Users/ASUS/OneDrive/Dokumen/Data Novel/penerbit.csv")
data_ulasan <- read_csv("C:/Users/ASUS/OneDrive/Dokumen/Data Novel/ulasan.csv")

# === Data Koordinat Kota ===
koordinat_kota <- data.frame(
  alamat = c("Bandung", "Banten", "Bogor", "Jakarta", "Yogyakarta", "Sleman"),
  latitude = c(-6.9175, -6.4058, -6.5950, -6.2088, -7.7956, -7.7156),
  longitude = c(107.6191, 106.1641, 106.8166, 106.8456, 110.3695, 110.3555)
)
# Gabungkan data penerbit dengan koordinat kota
data_kota <- merge(data_penerbit, koordinat_kota, by = "alamat")

# === 3. UI: Struktur Dashboard ===
ui <- dashboardPage(
  dashboardHeader(title = "Chapter & Coffe"),
  
  dashboardSidebar(
    collapsed = FALSE,
    
  tags$head(
    tags$style(HTML("
      .sidebar-menu {
        padding-top: 20px;
      }
      .sidebar-menu > li > a {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
        font-weight: 600;
        color: #6c757d;
        padding: 10px 20px;
        transition: all 0.3s ease-in-out;
      }
      .sidebar-menu > li > a:hover, 
      .sidebar-menu > li.active > a {
        color: #1E40AF;
        background-color: #E0E7FF;
        border-radius: 8px;
      }
      .sidebar-menu > li > a > i {
        font-size: 18px;
      }
    "))
  ),
    sidebarMenu(
      menuItem("Cari Novel Di Sini", tabName = "my_books", icon = icon("book")),
      menuItem("Penulis", tabName = "authors", icon = icon("user")),
      menuItem("Penerbit", tabName = "publishers", icon = icon("building")),
      menuItem("Ulasan", tabName = "reviews", icon = icon("star")),
      menuItem("Novel dalam Statistik", tabName = "stats", icon = icon("chart-bar"))
    )
  ),
  
  dashboardBody(
    tabItems(
      
      #Tab Item Novel      
      tabItem(tabName = "my_books",
        fluidRow(
          column(12, textInput("search", "Cari Novel", placeholder = "Type novel title...")),
          column(12, h2("Novel Terbaik Berdasarkan Ratings")),
          column(12,uiOutput("best_novel")),
          column(12, h2("Koleksi Novel")),
          fluidRow(
  column(12, align = "center",
    tags$div(
      style = "display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;",
      actionButton("btn_all", "All", class = "btn-category active"),
      actionButton("btn_fiction", "Fiksi", class = "btn-category"),
      actionButton("btn_nonfiction", "Bukan Fiksi", class = "btn-category"),
      actionButton("btn_fantasi", "Fantasi", class = "btn-category"),
      actionButton("btn_romansa", "Romansa", class = "btn-category"),
      actionButton("btn_literature", "Literatur Indonesia", class = "btn-category")
    ),
    tags$style(HTML("
      .btn-category {
        background-color: #f0f3ff; 
        border: none; 
        color: #34495e; 
        font-size: 14px; 
        font-weight: bold;
        padding: 10px 20px;
        border-radius: 20px; 
        cursor: pointer;
        gap: 20px;
        transition: all 0.3s ease-in-out;
      }
      .btn-category:hover {
        background-color: #d6dbff; 
      }
      .btn-category.active {
        background-color: #3b82f6; 
        color: white;
      }
    "))
  ),
  tags$hr()
),
          column(12, fluidRow(uiOutput("novel_cards")))
        )
      ),
      
  #Tab Item Penulis      
      tabItem(tabName = "authors",
        fluidRow(
    valueBox(
      value = nrow(data_penulis),  # Menampilkan total jumlah penerbit
      subtitle = "Total Penulis",
      icon = tags$i(class = "fa fa-users", style = "color: white;"),
      color = "navy",
      width = 6
    ),
    valueBox(
      value = sum(data_penulis$jumlah_buku),
      subtitle = "Jumlah Buku Terbitan Penulis",
      icon = icon("book"),
      color = "yellow",
      width = 6
    )
  ),
              
        fluidRow(
    column(6, 
      column(12, h2("Penulis Terfavorit")),
      column(12, uiOutput("most_fav_author")
      )
    ),
    column(6, 
      column(12, h2("Penulis dengan Karya Terbanyak")),
      column(12, uiOutput("top_author")
      )
    )
  ),
  box(title = "List of Authors", status = "info", solidHeader = TRUE, width = 12, DTOutput("authors_table"))
),
      
  #Tab Item Penerbit
    tabItem(tabName = "publishers",
        fluidRow(
    valueBox(
      value = nrow(data_penerbit),  # Menampilkan total jumlah penerbit
      subtitle = "Total Penerbit",
      icon = icon("building"),
      color = "orange",
      width = 6
    ),
    valueBox(
      value = paste0(round(mean(data_penerbit$rating_penerbit, na.rm = TRUE), 2), " %"),  # Contoh nilai dummy
      subtitle = "Rating Rata-rata",
      icon = icon("chart-pie"),
      color = "green",
      width = 6
    )
  ),
            
        fluidRow(
          column(12, h2("Peta Penerbit Buku")),
          column(12, box(status = "info", solidHeader = FALSE, width = 12, leafletOutput("map_penerbit", height = "600px")))
        ),
        column(12, h2("List Penerbit")),
        box(title = "List of Publishers", status = "info", solidHeader = FALSE, width = 12, DTOutput("publishers_table"))
      ),

  #Tab Item Ulasan
      tabItem(tabName = "reviews",
        column(12, h2("Penulis Terfavorit")),
        box(status = "warning", solidHeader = FALSE, width = 12, DTOutput("reviews_table"))
      ),
      
  #Tab Item Statistik
      tabItem(tabName = "stats",
        fluidRow(
          # Value Boxes for Key Metrics
          box(
            title = "Total Novel yang Dikelola",
            valueBoxOutput("total_novels"),
            width = 4, status = "primary", solidHeader = TRUE
          ),
          box(
            title = "Jumlah Novel per Tahun Terbit",
            plotOutput("novels_per_year_plot"),
            width = 8, status = "info", solidHeader = TRUE
          )
        ),
        
        fluidRow(
          # Pie Chart for Number of Novels per Category
          box(
            title = "Jumlah Novel per Klasifikasi",
            plotOutput("novels_per_category_plot"),
            width = 6, status = "success", solidHeader = TRUE
          ),
          
          # Pie Chart for Number of Novels per Publisher
          box(
            title = "Jumlah Novel per Penerbit",
            plotOutput("novels_per_publisher_plot"),
            width = 6, status = "warning", solidHeader = TRUE
